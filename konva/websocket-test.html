<!DOCTYPE html>
<html>
  <head>
    <script src="https://unpkg.com/konva@8.1.1/konva.min.js"></script>
    <meta charset="utf-8" />
    <title>WebSocket Demo</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #f0f0f0;
      }
    </style>
    <script src="robo_simul.js"></script>
  </head>
  <body>
    <div id="container"></div>
    <script>

console.log("hello");    
const USE_BINARY_PROTOCOL = true;
// https 사용 시.
// const ws = new WebSocket('wss://localhost:7070/', {
//     origin: 'https://localhost:7070'
// })
//const ws = new WebSocket('ws://localhost:7070/')

const ws = new WebSocket('ws://192.168.10.211:30303/WebUI')
if (USE_BINARY_PROTOCOL) {
  ws.binaryType = 'arraybuffer' // <- 중요! binary 사용 시 지정 필수
}

ws.onopen= function open() {
    console.log('connected')
}
ws.onclose = function close() {
    console.log('disconnected')
}
ws.onerror = function error(err) {
    console.log('Error: ' + err)
}
ws.onmessage = function incoming(data, flags) {
    console.log('message')
    console.log(data.data)

    if (USE_BINARY_PROTOCOL) {
      var bytes = data.data.slice(0); 
      // var message = proto.VirtualObject.deserializeBinary(bytes)
      var message = proto.kr.ac.uos.ai.mcmonitor.EventGenerate.deserializeBinary(bytes)
      console.log(message.toObject());
      /* console.log("name: " + message.getName())
      console.log("pos: " + message.getPos().getX() + ", " + message.getPos().getY());
      console.log("size: " + message.getSize().getX() + ", " + message.getSize().getY());
      console.log("flags: [" + message.getFlagsList() + "]")

      console.log("properties: " + message.getPropertiesMap())
      console.log("properties['p1']: " + message.getPropertiesMap().get("p1")) */
      ws.close()
    }
    else {

      var reader = new FileReader();
      reader.onload = function() {
          alert(reader.result);
      }
      var s = reader.readAsArrayBuffer(data.data);
      console.log(s)

      var env = proto.kr.ac.uos.ai.mcmonitor.Environment.deserializeFormBinaryReader(reader);
      console.log(env)
    }
}

console.log("ready!");    

    </script>
  </body>
</html>