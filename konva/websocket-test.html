<!DOCTYPE html>
<html>
  <head>
    <script src="https://unpkg.com/konva@8.1.1/konva.min.js"></script>
    <meta charset="utf-8" />
    <title>Konva Shape Caching Demo</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #f0f0f0;
      }
    </style>
    <script src="bundle.js"></script>
  </head>
  <body>
    <div id="container"></div>
    <script>
// https 사용 시.
// const ws = new WebSocket('wss://localhost:7070/', {
//     origin: 'https://localhost:7070'
// })
const ws = new WebSocket('ws://localhost:7070/')
ws.binaryType = 'arraybuffer' // <- 중요! binary 사용 시 지정 필수

ws.onopen= function open() {
    console.log('connected')
}
ws.onclose = function close() {
    console.log('disconnected')
}
ws.onmessage = function incoming(data, flags) {
    console.log('message')
    var bytes = data.data.slice(0); // 오류 -> Array.prototype.slice.call(data.data, 0)
    var message = proto.VirtualObject.deserializeBinary(bytes)
    console.log(message.toObject());
    console.log("name: " + message.getName())
    console.log("pos: " + message.getPos().getX() + ", " + message.getPos().getY());
    console.log("size: " + message.getSize().getX() + ", " + message.getSize().getY());
    console.log("flags: [" + message.getFlagsList() + "]")

    console.log("properties: " + message.getPropertiesMap())
    console.log("properties['p1']: " + message.getPropertiesMap().get("p1"))
    ws.close()
}
    </script>
  </body>
</html>